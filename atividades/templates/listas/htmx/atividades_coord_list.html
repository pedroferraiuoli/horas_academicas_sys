 <!-- Lista Responsiva de Atividades -->
{% load static %}

<!-- Container da Lista -->
<div class="atividades-list">
    {% for atividade in atividades %}
        <div class="atividade-item" id="atividade-{{ atividade.id }}">
            <!-- Linha principal (Desktop: tabela / Mobile: card compacto) -->
            <div class="atividade-main"
                 data-bs-toggle="collapse"
                 data-bs-target="#collapse-coord-{{ atividade.id }}"
                 aria-expanded="false">

                <div class="row g-2">
                    <!-- Aluno (apenas quando não é visualização individual) -->
                    {% if not aluno %}
                        <div class="col-lg-2 col-12">
                            <div class="ativ-col">
                                <span class="ativ-label">Aluno</span>
                                <span class="ativ-value">{{ atividade.aluno.nome }}</span>
                            </div>
                        </div>

                        <div class="col-lg-1 col-12">
                            <div class="ativ-col">
                                <span class="ativ-label">Matrícula</span>
                                <span class="ativ-value">{{ atividade.aluno.matricula }}</span>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Nome da Atividade -->
                    <div class="col-lg-2 col-6">
                        <div class="ativ-col">
                            <span class="ativ-label">Nome</span>
                            <span class="ativ-value">{{ atividade.nome }}</span>
                        </div>
                    </div>

                    <!-- Categoria (apenas desktop) -->
                    <div class="col-lg-2 desktop-only">
                        <div class="ativ-col">
                            <span class="ativ-label">Categoria</span>
                            <span class="ativ-value">{{ atividade.categoria.categoria.nome }}</span>
                        </div>
                    </div>

                    <!-- Horas -->
                    <div class="col-lg col-3">
                        <div class="ativ-col">
                            <span class="ativ-label">Horas</span>
                            <span class="ativ-value">
                                <span class="badge bg-opacity-75">{{ atividade.horas }}h</span>
                            </span>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="col-lg col-3">
                        <div class="ativ-col">
                            <span class="ativ-label">Status</span>
                            <span class="ativ-value">
                                {% if atividade.status == 'Rejeitada' %}
                                    <span class="badge bg-danger">Rejeitada</span>
                                {% elif atividade.status == 'Pendente' %}
                                    <span class="badge bg-warning text-dark">Aguardando</span>
                                {% elif atividade.status == 'Limite Atingido' %}
                                    <span class="badge bg-secondary">Limite Categoria Atingido</span>
                                {% else %}
                                    <span class="badge bg-success">{{ atividade.horas_aprovadas }}h</span>
                                {% endif %}
                            </span>
                        </div>
                    </div>

                    <!-- Documento (apenas desktop) -->
                    <div class="col-lg desktop-only">
                        <div class="ativ-col">
                            <span class="ativ-label">Documento</span>
                            <div class="ativ-value">
                                {% if atividade.documento %}
                                    <a href="{{ atividade.documento.url }}"
                                       target="_blank"
                                       class="btn btn-outline-main-blue btn-sm">
                                        <i class="bi bi-file-earmark-pdf"></i>
                                    </a>
                                {% else %}
                                    <span class="text-muted">—</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Observação (apenas desktop) -->
                    <div class="col-lg desktop-only">
                        <div class="ativ-col">
                            <span class="ativ-label">Observação</span>
                            <div class="ativ-value">
                                {% if atividade.observacoes_para_aprovador %}
                                    <button type="button"
                                            class="btn btn-outline-main-blue btn-sm"
                                            data-bs-toggle="modal"
                                            data-bs-target="#obsModal{{ forloop.counter }}">
                                        <i class="bi bi-chat-left-text"></i>
                                    </button>
                                {% else %}
                                    <span class="text-muted">—</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Ações (apenas desktop) -->
                    <div class="col-lg desktop-only">
                        <div class="ativ-col">
                            <span class="ativ-label">Ações</span>
                            <div class="ativ-actions">
                                {% if atividade.status != 'Limite Atingido' %}
                                    <button type="button"
                                            class="btn btn-outline-main-blue btn-sm"
                                            data-bs-toggle="modal"
                                            data-bs-target="#aprovarModal{{ forloop.counter }}">
                                        <i class="bi bi-check2-circle"></i>
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detalhes expandidos (mobile) -->
            <div class="collapse atividade-details" id="collapse-coord-{{ atividade.id }}">
                <div class="details-content">
                    <!-- Informações do Aluno (quando não é visualização individual) -->
                    {% if not aluno %}
                        <div class="detail-row">
                            <span class="detail-label">Aluno:</span>
                            <span class="detail-value">{{ atividade.aluno.nome }}</span>
                        </div>
                    {% endif %}

                    <!-- Categoria -->
                    <div class="detail-row">
                        <span class="detail-label">Categoria:</span>
                        <span class="detail-value">{{ atividade.categoria.categoria.nome }}</span>
                    </div>

                    <!-- Data -->
                    <div class="detail-row">
                        <span class="detail-label">Data:</span>
                        <span class="detail-value">{{ atividade.data }}</span>
                    </div>

                    <!-- Horas Aprovadas -->
                    <div class="detail-row">
                        <span class="detail-label">Horas Aprovadas:</span>
                        <span class="detail-value">
                            {% if atividade.horas_aprovadas is not None %}
                                {{ atividade.horas_aprovadas }}h
                            {% else %}
                                —
                            {% endif %}
                        </span>
                    </div>

                    <!-- Documento -->
                    {% if atividade.documento %}
                        <div class="detail-row">
                            <span class="detail-label">Documento:</span>
                            <span class="detail-value">
                                <a href="{{ atividade.documento.url }}"
                                   target="_blank"
                                   class="btn btn-outline-main-blue btn-sm">
                                    <i class="bi bi-eye"></i> Ver
                                </a>
                            </span>
                        </div>
                    {% endif %}

                    <!-- Observação -->
                    {% if atividade.observacoes_para_aprovador %}
                        <div class="detail-row">
                            <span class="detail-label">Observação:</span>
                            <span class="detail-value">
                                <button type="button"
                                        class="btn btn-outline-main-blue btn-sm"
                                        data-bs-toggle="modal"
                                        data-bs-target="#obsModal{{ forloop.counter }}">
                                    Ver observação
                                </button>
                            </span>
                        </div>
                    {% endif %}

                    <!-- Ações Mobile -->
                    {% if atividade.status != 'Limite Atingido' %}
                        <div class="detail-actions">
                            <button type="button"
                                    class="btn btn-outline-main-blue btn-sm w-100"
                                    data-bs-toggle="modal"
                                    data-bs-target="#aprovarModal{{ forloop.counter }}">
                                <i class="bi bi-check2-circle"></i>
                                {% if atividade.status == 'Pendente' %}
                                    Aprovar Atividade
                                {% elif atividade.status == 'Rejeitada' %}
                                    Reaproveitar Atividade
                                {% else %}
                                    Editar Aprovação
                                {% endif %}
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Modals fora do loop visual -->
        {% include "listas/partials/modal_observacao.html" %}
        {% include "listas/partials/modal_aprovacao.html" %}

    {% empty %}
        <!-- Mensagem quando não há atividades -->
        <div class="text-center text-muted py-4">
            Nenhuma atividade cadastrada para este aluno.
        </div>
    {% endfor %}
</div>

<!-- Paginação -->
{% include 'pagination.html' with qs=atividades %}

<!-- Scripts -->
<script src="{% static 'js/listar_atividades.js' %}"></script>
