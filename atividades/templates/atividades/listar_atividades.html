{% extends 'base.html' %}
{% load atividade_extras %}
{% block content %}
<h2 class="text-main-blue mt-3">Minhas Atividades</h2>
{% if categoria_filtrada %}
  <div class="alert alert-warning">Filtrando por categoria: <b>{{ categoria_filtrada.categoria.nome }}</b> <a href="{% url 'listar_atividades' %}" class="btn btn-sm btn-outline-main-blue ms-2">Remover filtro</a></div>
{% endif %}
<a href="{% url 'cadastrar_atividade' %}?categoria={{ categoria_filtrada.id }}" class="btn btn-info mb-3"><i class="bi bi-plus-circle"></i> Nova Atividade</a>

<form method="get" class="mb-3">
  <div class="row g-2 align-items-center">
    <div class="col-4">
      {{ filter.form.status }}
    </div>
    <div class="col-4">
      {{ filter.form.categoria }}
    </div>
    <div class="col-3">
      <button type="submit" class="btn btn-sm btn-outline-main-blue">Filtrar</button>
      <button type="button" class="btn btn-sm btn-outline-secondary" onclick="window.location.href='{% url 'listar_atividades' %}'">Limpar</button>
    </div>
  </div>
</form>

<!-- Tabela Responsiva -->
<div class="atividades-list">
  {% for atividade in atividades %}
  <div class="atividade-item" id="atividade-{{ atividade.id }}">
    <!-- Desktop: linha de tabela / Mobile: card compacto -->
    <div class="atividade-main" data-bs-toggle="collapse" data-bs-target="#collapse-{{ atividade.id }}" aria-expanded="false">
      <div class="ativ-col ativ-nome">
        <span class="ativ-label">Nome</span>
        <span class="ativ-value">{{ atividade.nome }}</span>
      </div>
      <div class="ativ-col ativ-nome desktop-only">
        <span class="ativ-label">Categoria</span>
        <span class="ativ-value">{{ atividade.categoria.categoria.nome }}</span>
      </div>
      <div class="ativ-col ativ-horas">
        <span class="ativ-label">Horas</span>
        <span class="ativ-value"><span class="badge bg-opacity-75">{{ atividade.horas }}h</span></span>
      </div>
      <div class="ativ-col ativ-status">
        <span class="ativ-label">Aprovadas</span>
        <span class="ativ-value">
          {% if atividade.horas_aprovadas is not None %}
            <span class="badge bg-success">{{ atividade.horas_aprovadas }}h</span>
          {% else %}
            <span class="badge bg-warning text-dark">Aguardando</span>
          {% endif %}
        </span>
      </div>
      <div class="ativ-col ativ-data desktop-only">
        <span class="ativ-label">Data</span>
        <span class="ativ-value">{{ atividade.data }}</span>
      </div>
      <div class="ativ-col ativ-actions desktop-only">
        <span class="ativ-label">Ações</span>
        <span class="ativ-value">
          <a href="{% url 'editar_atividade' atividade.id %}" class="btn btn-outline-main-blue btn-sm"><i class="bi bi-pencil"></i> Editar</a>
          <a href="{% url 'excluir_atividade' atividade.id %}" class="btn btn-danger btn-sm"><i class="bi bi-trash"></i> Excluir</a>
          {% if atividade.documento %}
            <a href="{{ atividade.documento.url }}" target="_blank" class="btn btn-outline-main-blue btn-sm"><i class="bi bi-eye"></i> Visualizar</a>
            <a href="{{ atividade.documento.url }}" download class="btn btn-outline-main-blue btn-sm"><i class="bi bi-download"></i> Baixar</a>
          {% endif %}
        </span>
      </div>
    </div>
    
    <!-- Detalhes expandidos (mobile) -->
    <div class="collapse atividade-details" id="collapse-{{ atividade.id }}">
      <div class="details-content">
        <div class="detail-row">
          <span class="detail-label">Categoria:</span>
          <span class="detail-value">{{ atividade.categoria.categoria.nome }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Data:</span>
          <span class="detail-value">{{ atividade.data }}</span>
        </div>
        {% if atividade.documento %}
        <div class="detail-row">
          <span class="detail-label">Documento:</span>
          <span class="detail-value">
            <a href="{{ atividade.documento.url }}" target="_blank" class="btn btn-outline-main-blue btn-sm">
              <i class="bi bi-eye"></i> Ver
            </a>
            <a href="{{ atividade.documento.url }}" download class="btn btn-outline-main-blue btn-sm">
              <i class="bi bi-download"></i> Baixar
            </a>
          </span>
        </div>
        {% endif %}
        <div class="detail-actions">
          <a href="{% url 'editar_atividade' atividade.id %}" class="btn btn-outline-main-blue btn-sm w-100 mb-2">
            <i class="bi bi-pencil"></i> Editar
          </a>
          <a href="{% url 'excluir_atividade' atividade.id %}" class="btn btn-danger btn-sm w-100">
            <i class="bi bi-trash"></i> Excluir
          </a>
        </div>
      </div>
    </div>
  </div>
  {% empty %}
  <div class="text-center text-muted py-4">
    Nenhuma atividade cadastrada.
  </div>
  {% endfor %}
</div>

<a href="{% url 'dashboard' %}" class="btn btn-outline-main-blue mt-3"><i class="bi bi-arrow-left"></i> Voltar</a>
{% endblock %}
