{% load static %}

{% block content %}

    <!-- Header do Dashboard -->
    <div class="dashboard-header">
        <h2 class="orange dashboard-welcome">Bem-vindo, {{ aluno.nome }}!</h2>
        
        <div class="dashboard-actions">
            <!-- Botão Cadastrar Atividade -->
            <button type="button" 
                    class="btn btn-info"
                    hx-get="{% url 'cadastrar_atividade' %}"
                    hx-trigger="click"
                    hx-target="#modal-container"
                    hx-swap="innerHTML">
                <i class="bi bi-plus-circle"></i>
                <span class="btn-text">Cadastrar Atividade</span>
            </button>
            
            <!-- Botão Listar Atividades -->
            <button type="button" 
                    class="btn btn-info"
                    hx-get="{% url 'listar_atividades' %}"
                    hx-trigger="click"
                    hx-target="#aluno-container"
                    hx-swap="innerHTML"
                    hx-push-url="true">
                <i class="bi bi-list"></i>
                <span class="btn-text">Listar Atividades</span>
            </button>
            
            <!-- Botão Gerar Relatório -->
            <a href="{% url 'gerar_relatorio_aluno' %}" 
               class="btn btn-primary" 
               title="Gerar relatório em PDF">
                <i class="bi bi-file-earmark-pdf"></i>
                <span class="btn-text">Gerar Relatório</span>
            </a>
        </div>
    </div>

    <!-- Informações do Curso -->
    <p class="dashboard-course-info">
        Curso: <span class="fw-bold">{{ aluno.curso }} ({{ horas_requeridas }}h)</span>
    </p>

    <!-- Alerta de Limite Ultrapassado -->
    {% if ultrapassou_limite %}
        <div class="alert alert-warning alert-dismissible fade show d-flex align-items-center gap-2" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            Você possui categorias em que o total de horas aprovadas excede o limite permitido. 
            Apenas as horas dentro do limite serão consideradas para a conclusão.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
        </div>
    {% endif %}

    <!-- Container do Dashboard com HTMX -->
    <div id="dashboard-aluno-container"
         >
       

<div id="dashboard-aluno-container"
     hx-get="{% url 'dashboard' %}"
     hx-trigger="atividadeModified from:body"
     hx-swap="innerHTML">

    <!-- Seção de progresso -->
    <div class="dashboard-progress-section">
        <div class="progress-info">
            <span class="progress-percentage">{{ progresso_percentual }}%</span>
            <span class="progress-hours">{{ total_horas }}h / {{ horas_requeridas }}h</span>
        </div>

        <div class="progress dashboard-progress-bar">
            <div class="progress-bar"
                 role="progressbar"
                 style="width:{{ progresso_percentual }}%;"
                 aria-valuenow="{{ progresso_percentual }}"
                 aria-valuemin="0"
                 aria-valuemax="100">
                <span class="fw-bold">{{ total_horas }} / {{ horas_requeridas }}h</span>
            </div>
        </div>

        <span class="dashboard-course-info">
            Horas pendentes: {{ horas_pendentes }}h |
            Horas válidas: {{ total_horas }}h |
            Total: {{ horas_totais }}h
        </span>
    </div>

    <!-- Últimas atividades cadastradas -->
    <h4 class="mt-5 main-blue">Últimas atividades cadastradas</h4>

    <div id="atividades-recentes-container">
        {% if atividades_recentes %}
            <!-- Lista Responsiva de Atividades -->
            {% include "listas/htmx/atividades_list.html" with atividades=atividades_recentes %}
        {% else %}
            <p class="text-muted mt-4">Nenhuma atividade cadastrada ainda.</p>
        {% endif %}
    </div>

</div>

<!-- Container para modais HTMX (usado para formulário de atividade) -->
<div id="modal-container"></div>
    </div>

    <!-- Scripts -->
    <script src="{% static 'js/listar_atividades.js' %}"></script>
{% endblock %}
